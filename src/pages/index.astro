---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Get all players and hardware
const players = await getCollection('players');
const mice = await getCollection('mice');

// Create lookup maps for hardware
const miceMap = new Map(mice.map(m => [m.id, m.data]));

// Sort players by rating (highest first)
const sortedPlayers = players.sort((a, b) => (b.data.rating || 0) - (a.data.rating || 0));

const base = import.meta.env.BASE_URL;
---

<BaseLayout title="Player Database">
  <div class="page-header">
    <h1>Professional Player Settings</h1>
    <p>Mouse settings, hardware, and configs from {players.length} pro players</p>
  </div>

  <div class="filters">
    <div class="filter-group">
      <label for="category-filter">Category:</label>
      <select id="category-filter">
        <option value="all">All Players</option>
        <option value="duel">Duel</option>
        <option value="ctf">CTF</option>
        <option value="tdm">TDM</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="sens-filter">Sensitivity Range:</label>
      <select id="sens-filter">
        <option value="all">All</option>
        <option value="low">Low (&lt; 800 eDPI)</option>
        <option value="medium">Medium (800-1500 eDPI)</option>
        <option value="high">High (&gt; 1500 eDPI)</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="sort-by">Sort by:</label>
      <select id="sort-by">
        <option value="rating">Rating</option>
        <option value="edpi-asc">eDPI (Low to High)</option>
        <option value="edpi-desc">eDPI (High to Low)</option>
        <option value="name">Name</option>
      </select>
    </div>
  </div>

  <div class="player-grid" id="player-grid">
    {sortedPlayers.map((player) => {
      const mouseData = miceMap.get(player.data.mouse);
      return (
        <a
          href={`${base}players/${player.id}/`}
          class="player-card"
          data-name={player.data.name.toLowerCase()}
          data-category={player.data.category}
          data-edpi={player.data.edpi}
          data-dpi={player.data.dpi}
          data-rating={player.data.rating || 0}
          data-mouse={player.data.mouse}
        >
          <div class="player-card-header">
            <span class="player-name">{player.data.name}</span>
            <span class="player-country">{player.data.country}</span>
          </div>

          <div class="player-card-stats">
            <div class="stat">
              <span class="stat-label">DPI</span>
              <span class="stat-value">{player.data.dpi}</span>
            </div>
            <div class="stat">
              <span class="stat-label">Sens</span>
              <span class="stat-value">{player.data.sensitivity}</span>
            </div>
            <div class="stat">
              <span class="stat-label">eDPI</span>
              <span class="stat-value">{player.data.edpi}</span>
            </div>
            <div class="stat">
              <span class="stat-label">cm/360</span>
              <span class="stat-value">{player.data.cm360 || 'â€”'}</span>
            </div>
          </div>

          {mouseData && (
            <div class="player-card-hardware">
              <span class="hardware-tag">{mouseData.name}</span>
            </div>
          )}

          {player.data.rating && (
            <div class="player-rating">
              Rating: {player.data.rating}
            </div>
          )}
        </a>
      );
    })}
  </div>

  <script src={`${base}scripts/filter.js`}></script>
</BaseLayout>
